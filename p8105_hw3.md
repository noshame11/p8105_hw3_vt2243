Homework \#3
================
Vincent Tam
October 9, 2018

    ## -- Attaching packages --------------------------------------------------------------------------- tidyverse 1.2.1 --

    ## v ggplot2 3.0.0     v purrr   0.2.5
    ## v tibble  1.4.2     v dplyr   0.7.6
    ## v tidyr   0.8.1     v stringr 1.3.1
    ## v readr   1.1.1     v forcats 0.3.0

    ## -- Conflicts ------------------------------------------------------------------------------ tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

    ## 
    ## Attaching package: 'ggridges'

    ## The following object is masked from 'package:ggplot2':
    ## 
    ##     scale_discrete_manual

Problem 1 - Behavioral Risk Factors Surveillance System (BRFSS) Data

``` r
## Clean, Filter, Select, Mutate, and Separate Variables
brfss_data = 
  brfss_smart2010 %>%
## format the data to use appropriate variable names
  janitor::clean_names() %>%
## focus on the “Overall Health” topic
  filter(topic == "Overall Health") %>%
## include only responses from “Excellent” to “Poor”
  filter(response == "Excellent" | response == "Very Good" | response == "Good" | response == "Fair" | response == "Poor") %>%
## organize responses as a factor taking levels ordered from “Excellent” to “Poor”
  mutate(cleaned_response = as.factor(response)) %>%
  ## organize and select relevant columns for questions
  select(year, locationdesc, topic, response, data_value) %>%
  separate(locationdesc, into = c("state", "county"), sep = " - ")
brfss_data
```

    ## # A tibble: 8,500 x 6
    ##     year state county            topic          response  data_value
    ##    <int> <chr> <chr>             <chr>          <chr>          <dbl>
    ##  1  2010 AL    Jefferson County  Overall Health Excellent       18.9
    ##  2  2010 AL    Jefferson County  Overall Health Good            33.1
    ##  3  2010 AL    Jefferson County  Overall Health Fair            12.5
    ##  4  2010 AL    Jefferson County  Overall Health Poor             5.5
    ##  5  2010 AL    Mobile County     Overall Health Excellent       15.6
    ##  6  2010 AL    Mobile County     Overall Health Good            31.2
    ##  7  2010 AL    Mobile County     Overall Health Fair            15.5
    ##  8  2010 AL    Mobile County     Overall Health Poor             6.4
    ##  9  2010 AL    Tuscaloosa County Overall Health Excellent       20.8
    ## 10  2010 AL    Tuscaloosa County Overall Health Good            33.8
    ## # ... with 8,490 more rows

Answers to Homework Questions

``` r
brfss_data_2002 =
  filter(brfss_data, year == "2002") %>%
  distinct(state, county) %>%
  count(state) %>%
  filter(n == 7)
## In 2002, which states were observed at 7 locations?
"In 2002, the following states had 7 locations:" 
```

    ## [1] "In 2002, the following states had 7 locations:"

``` r
brfss_data_2002
```

    ## # A tibble: 3 x 2
    ##   state     n
    ##   <chr> <int>
    ## 1 CT        7
    ## 2 FL        7
    ## 3 NC        7

``` r
## Spaghetti Plots
brfss_plot = 
  brfss_data %>%
  distinct(year, state, county) %>%
  select(year, state, county) %>%
  group_by(year, state) %>%
  mutate(count = n())
"Spaghetti Plot showing the number of locations in each state from 2002 to 2010."
```

    ## [1] "Spaghetti Plot showing the number of locations in each state from 2002 to 2010."

``` r
ggplot(brfss_plot, aes(x = year, y = count, color = state)) + geom_point() + geom_line()
```

![](p8105_hw3_files/figure-markdown_github/Spaghetti%20Plotting-1.png)

Making Table
------------

``` r
brfss_table =   
  brfss_data %>%
  filter(year == '2002' | year == '2006' | year == '2010') %>%
  filter(state == 'NY') %>%
  filter(response == 'Excellent') %>%
  mutate(data_value_numeric = as.numeric(data_value)) %>%
  group_by(year) %>%
  summarize(brfss_NYexcellentsd = sd(data_value_numeric), brfss_NYexcellentmean = mean(data_value_numeric))
brfss_table
```

    ## # A tibble: 3 x 3
    ##    year brfss_NYexcellentsd brfss_NYexcellentmean
    ##   <int>               <dbl>                 <dbl>
    ## 1  2002                4.49                  24.0
    ## 2  2006                4.00                  22.5
    ## 3  2010                3.57                  22.7

``` r
brfss_proportions = 
  brfss_data %>%
  mutate(year_factor = as.factor(year)) %>%
  group_by(year_factor, state, response) %>%
  summarize(brfss_excellentmean = mean(data_value), 
            brfss_verygoodmean = mean(data_value), 
            brfss_goodmean = mean(data_value),
            brfss_fairmean = mean(data_value),
            brfss_poormean = mean(data_value)) %>%
  gather(key = cleaned_response, value = proportion, brfss_excellentmean:brfss_poormean) %>% 
  mutate(response_f = factor('cleaned_response', levels = c('brfss_excellentmean', 'brfss_verygoodmean', 'brfss_goodmean', 'brfss_fairmean', 'brfss_poormean')))
ggplot(brfss_proportions, aes(x = year_factor, y = proportion)) + geom_boxplot() + facet_grid(. ~ response_f) +
  theme(axis.text.x = element_text(angle = 90)) + labs(title = "Average Proportion per Response Category"  )
```

    ## Warning: Removed 75 rows containing non-finite values (stat_boxplot).

![](p8105_hw3_files/figure-markdown_github/Average%20Proportions-1.png)

``` r
brfss_proportions
```

    ## # A tibble: 8,860 x 6
    ## # Groups:   year_factor, state [443]
    ##    year_factor state response  cleaned_response    proportion response_f
    ##    <fct>       <chr> <chr>     <chr>                    <dbl> <fct>     
    ##  1 2002        AK    Excellent brfss_excellentmean       27.9 <NA>      
    ##  2 2002        AK    Fair      brfss_excellentmean        8.6 <NA>      
    ##  3 2002        AK    Good      brfss_excellentmean       23.8 <NA>      
    ##  4 2002        AK    Poor      brfss_excellentmean        5.9 <NA>      
    ##  5 2002        AL    Excellent brfss_excellentmean       18.5 <NA>      
    ##  6 2002        AL    Fair      brfss_excellentmean       12.1 <NA>      
    ##  7 2002        AL    Good      brfss_excellentmean       32.7 <NA>      
    ##  8 2002        AL    Poor      brfss_excellentmean        5.9 <NA>      
    ##  9 2002        AR    Excellent brfss_excellentmean       24.1 <NA>      
    ## 10 2002        AR    Fair      brfss_excellentmean       12.5 <NA>      
    ## # ... with 8,850 more rows

Problem \#2
-----------

``` r
## install.packages("devtools")
## devtools::install_github("p8105/p8105.datasets"); already installed but do not want to install every time
##library(p8105.datasets); already installed but do not want to install every time
library(tidyverse)
data(instacart)
```

``` r
instacart_cleaned =
  instacart %>%
  janitor::clean_names() 
length(unique(instacart_cleaned$aisle)) 
```

``` r
most_ordered =
  instacart_cleaned %>%
  group_by(aisle_id) %>%
  summarize(n = n()) %>%
  filter(min_rank(desc(n))<6)
most_ordered
```

most\_ordered %&gt;% group\_by(aisle\_id, n) %&gt;% mutate(temp\_ranking = min\_rank(most\_ordered))

``` r
## most_ordered %>%
##  mutate(aisle_idnumeric = as.factor(aisle_id)) %>%
##  mutate(aisle_idnumeric = forcats::fct_reorder(aisle_id_numeric, n)) %>%
##  ggplot(most_ordered, aes(x = aisle_idnumeric) + geom_bar(stat = "identity") + scale_x_discrete(drop = FALSE))
```

Problem \#3
-----------

``` r
data(ny_noaa)
```

``` r
nynoaa_cleaned = 
  ny_noaa %>% 
  janitor::clean_names() %>%
  separate(date, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(tmin = as.numeric(tmin)/10, tmax = as.numeric(tmax)/10)
```

``` r
nynoaa_snow = 
  nynoaa_cleaned %>%
  group_by(snow) %>%
  summarize(n = n()) %>%
  top_n(3)
```

    ## Selecting by n

``` r
nynoaa_snow
```

    ## # A tibble: 3 x 2
    ##    snow       n
    ##   <int>   <int>
    ## 1     0 2008508
    ## 2    25   31022
    ## 3    NA  381221

``` r
maxtempJanJul_plot =
  nynoaa_cleaned %>%
  select(year, month, id, tmin, tmax) %>%
  filter(month == "01" | month == "07") %>%
  group_by(year, month, id) %>%
  summarize(tmax_mean = mean(tmax)) %>%
  ggplot(aes(x = year, y = tmax_mean)) + geom_boxplot() + facet_grid(.~month) 
```
